<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Story Hub</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="0d17a570-e253-4fc0-ab9a-24a475760a59" class="page sans"><header><h1 class="page-title">Story Hub</h1><p class="page-description"></p></header><div class="page-body"><p id="a1e796dd-fa07-499b-8306-291f28b67dd9" class=""><mark class="highlight-gray_background"><a href="https://github.com/jsovelove/Story-Hub">Github</a></mark></p><p id="7b3ab0cb-4231-4e1f-9df6-88fda0c1cbb2" class="">This documentation serves as a technical overview of the Story Hub Skill</p><p id="9315559c-eccd-446c-aaa4-215de574e349" class=""><strong>Table of Contents</strong></p><nav id="6a8811f3-e4a6-4a92-8022-f1751be74079" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#21bea94c-1ea5-4aea-b318-043c54ed8f57">Key Features</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#83cf5c1a-2cb5-4b29-a9c0-12100c3f6cdd"><strong>Architecture Overview</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b116c0dd-c1b7-4b3a-ad93-95e10185b042"><strong>Firebase</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5b72b576-0115-4142-bb8d-873e575142cd">Intents and Utterances</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e96e8f4f-cb46-45cc-8229-97be99428a91">Intent Handlers</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#00a89dbe-b48a-44a6-81a0-da83c4f85cda">Audio Playback</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c06e72d0-3ecd-4184-997c-caae584e6b74"><strong>Persistent Attributes</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#ba1784d9-7cf1-4f8f-808b-59d61d381269">Audio Playback Functions</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#215fc891-7113-489f-a1f8-f6333fdaf9ce">Custom Audio Intents</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9141763a-054b-449c-94f8-598b97998c46">Current Issues and Limitations</a></div></nav><p id="f9a05f7f-edf5-4198-8a0b-7a82ca751c94" class="">
</p><h1 id="21bea94c-1ea5-4aea-b318-043c54ed8f57" class="">Key Features</h1><ul id="ac836b17-9b2c-4c85-9942-bef8fa9d5f2a" class="bulleted-list"><li style="list-style-type:disc">Ability to navigate a dynamic audio playlist retrieved from a database which includes:<ul id="d466d8f1-132a-46da-9e13-1b6d98603b39" class="bulleted-list"><li style="list-style-type:circle">A main playlist and sub playlists</li></ul><ul id="30ed2562-f5bd-49db-af6b-039ca9be25db" class="bulleted-list"><li style="list-style-type:circle">Branching points within the main playlist where the user can choose their path</li></ul></li></ul><h1 id="83cf5c1a-2cb5-4b29-a9c0-12100c3f6cdd" class=""><strong>Architecture Overview</strong></h1><h3 id="b116c0dd-c1b7-4b3a-ad93-95e10185b042" class=""><strong>Firebase</strong></h3><p id="07919d6a-3ee8-4485-8031-c84292ed8459" class="">This project utilizes Firebase&#x27;s Cloud Firestore, which serves as the primary database for storing and organizing audio collections. The database contains multiple collections of audio tracks. The audio tracks and their associated metadata, such as their order in the playlist or topic, are stored in Firestore collections and documents. Audio files themselves are stored in Google Cloud Storage.</p><p id="84ae9acc-ca5a-4bc2-a908-095c7e32b0d9" class="">
</p><figure id="6f50301f-c88f-4c9b-8175-bc7ec5619030" class="image"><a href="Story%20Hub%200d17a570e2534fc0ab9a24a475760a59/Untitled.png"><img style="width:1268px" src="firebasePic.png"/></a></figure><p id="89f4ace1-52b8-4e5a-b135-cfbfbca4f328" class="">
</p><p id="8b5456dc-c7b0-4b65-81c1-fa5e23843dd8" class=""> For the covid memories project, every audio track in the collection has the following metadata:</p><ul id="73caa281-d80b-4903-964d-cd0b7fe92cde" class="bulleted-list"><li style="list-style-type:disc"><code>mainPlaylist</code><ul id="a7f0ab33-6a91-4a60-a5cb-a4b1665ef675" class="bulleted-list"><li style="list-style-type:circle">Boolean value that dictates if a track is included in the main playlist</li></ul></li></ul><ul id="a6a5e6fb-cecc-4768-8d51-8f572a5c9876" class="bulleted-list"><li style="list-style-type:disc"><code>mainPlaylistOrder</code><ul id="52ea992a-90c2-45c2-b396-701ae08fda14" class="bulleted-list"><li style="list-style-type:circle">Order the track appears in the playlist</li></ul></li></ul><ul id="2990ee4a-b460-46df-b5b9-1b839dfd72cd" class="bulleted-list"><li style="list-style-type:disc"><code>name</code><ul id="c3a0e088-b8ed-4c4f-8181-326b6ba06626" class="bulleted-list"><li style="list-style-type:circle">name of the person who the track is associated with</li></ul></li></ul><ul id="3f040d48-6767-4d4a-946f-207239aa82e6" class="bulleted-list"><li style="list-style-type:disc"><code>playOrder</code><ul id="1b20ddbb-239f-4639-96b9-3f64963efc61" class="bulleted-list"><li style="list-style-type:circle">Order that tracks appears in the sub playlist for that individual</li></ul></li></ul><ul id="8fd7b7a6-cb2b-40fc-aef1-e010002a15c6" class="bulleted-list"><li style="list-style-type:disc"><code>theme</code><ul id="6cb0c748-a2b5-4787-aa3e-d258c7be47a6" class="bulleted-list"><li style="list-style-type:circle">the theme/topic associated with the track</li></ul></li></ul><ul id="60ba8592-673b-4e86-9ca4-2e17ceae1fe6" class="bulleted-list"><li style="list-style-type:disc"><code>themeOrder</code><ul id="32e1f45d-6421-4174-a387-164c521cbeb8" class="bulleted-list"><li style="list-style-type:circle">the order the track appears in the theme sub playlist</li></ul></li></ul><ul id="6253344f-52e5-407d-a0a9-14620b150266" class="bulleted-list"><li style="list-style-type:disc"><code>url</code><ul id="94d0cb65-c0cb-4fb0-a386-cbb5579005c0" class="bulleted-list"><li style="list-style-type:circle">address of the audio file</li></ul></li></ul><p id="d6f3a8bc-f72f-427d-ab74-b56770c5918d" class="">
</p><figure id="d4addfa1-f269-43be-bb78-7324b717b2d1" class="image"><a href="Story%20Hub%200d17a570e2534fc0ab9a24a475760a59/Untitled%201.png"><img style="width:384px" src="firebaseEntrypic.png"/></a></figure><p id="8e199d32-aca7-4185-b243-51c4ea7b89eb" class="">This metadata is used by Story Hub to query the collection for playback.</p><p id="31ebdd8c-fbba-4134-b9a0-22ed68e1048d" class="">
</p><hr id="c0acc749-d629-4fcf-a23d-204fab6e9104"/><h2 id="5b72b576-0115-4142-bb8d-873e575142cd" class="">Intents and Utterances</h2><div id="1aa1d4d3-2230-40e5-a9a9-4396d0f43912" class="column-list"><div id="53c30ad9-b7cb-4f95-9a16-5a7f14c73637" style="width:50.000000000000014%" class="column"><p id="702d2bd0-0e37-4272-9041-960578d37871" class=""><strong>Enter Collection</strong></p><p id="68494503-cc3a-4059-b88e-2269f7da7cdf" class="">How you open an audio collection.</p><p id="b97c9c62-b161-4360-b099-87c2e22d948f" class="">Example utterances:</p><ul id="db2da93b-e8c5-4113-ba2e-4ab3300cc019" class="bulleted-list"><li style="list-style-type:disc">open {CollectionName}</li></ul><ul id="53961e0e-ebf1-4725-ad31-8143dacc3b75" class="bulleted-list"><li style="list-style-type:disc">open the {CollectionName}</li></ul><ul id="59717a86-5e8d-4bf3-a841-21ea0be8c062" class="bulleted-list"><li style="list-style-type:disc">enter {CollectionName}</li></ul><ul id="97f123ac-8cc9-4ea3-a11a-bf11ba85e6e6" class="bulleted-list"><li style="list-style-type:disc">enter the {CollectionName}</li></ul></div><div id="091248ae-3417-426b-916e-a76924be0a1e" style="width:50%" class="column"><p id="5d4491c5-3ce7-444b-bb25-296c221c8ed0" class=""><strong>List collections</strong></p><p id="d562e8e7-91b4-450e-8727-11ee3cd666bc" class="">Lists all the current audio collections when first entering story hub.</p><p id="43af7d32-ca67-4cac-bd3f-094a1d33ac28" class="">Example utterances:</p><ul id="77045421-6f77-4363-a83e-275d71834e9e" class="bulleted-list"><li style="list-style-type:disc">list collections</li></ul><ul id="5c374f64-7a13-4a1d-a11f-5e2bb34dfc6e" class="bulleted-list"><li style="list-style-type:disc">list the collections</li></ul><ul id="3404fc85-b5a8-4d60-9b7e-201be01af96d" class="bulleted-list"><li style="list-style-type:disc">list all collections</li></ul></div></div><div id="a9d9198b-4247-4009-bbe7-bf611956432f" class="column-list"><div id="64f63d88-dec2-455d-a8ba-dd0dea99a5b4" style="width:50%" class="column"><p id="58094aed-7a2b-43d3-8be4-0f24c30955be" class=""><strong>More From Current Person</strong></p><p id="075ba15f-beb9-41e7-b90e-f0adb5c02db1" class="">Begins playing all the interviews with currently playing individual.</p><p id="bc3bf0ba-b26c-4ec3-8669-19810d0fee67" class="">Example utterances:</p><ul id="ba59758f-dcbd-4fb6-86cb-d1f47b037b36" class="bulleted-list"><li style="list-style-type:disc">play more from this person</li></ul><ul id="7b1dfbec-cbb7-444b-8d5d-177dcabbe310" class="bulleted-list"><li style="list-style-type:disc">play more from this current person</li></ul><ul id="8af7d401-7b28-4ff4-9d1c-24cd9a3a8e3f" class="bulleted-list"><li style="list-style-type:disc">play more from this individual</li></ul></div><div id="ac88f7e2-ee96-455f-97bf-7cd4cfb10959" style="width:50%" class="column"><p id="17e38608-5c5a-4a18-b7db-582cf242e3d7" class=""><strong>Play Current Theme</strong></p><p id="afe8c610-e71a-4a47-8a48-364a96c4657d" class="">Begins playing all the interviews from currently playing topic/theme.</p><p id="249a6a09-e04b-4b84-bc64-54a40ddbbf84" class="">Example utterances:</p><ul id="67526635-7717-4680-b685-5b73a360bd3d" class="bulleted-list"><li style="list-style-type:disc">play more on this topic</li></ul><ul id="a61268fd-b859-4aae-b6b4-8d5e1f95958d" class="bulleted-list"><li style="list-style-type:disc">play that playlist</li></ul><ul id="9f856fcc-02a7-487f-af14-5c120c295782" class="bulleted-list"><li style="list-style-type:disc">play that theme</li></ul></div></div><div id="d1039010-4b1d-4c06-9fb3-238310bb8eac" class="column-list"><div id="91a5dd9b-1264-4b1e-9cac-717b424fd468" style="width:50%" class="column"><p id="01c6bf05-cfec-420f-85ce-a3d961cf3552" class=""><strong>Enter Theme</strong></p><p id="4d231000-ff9a-4c20-a261-aa62f47d4231" class="">Begins playing all the interviews for a user specified topic</p><p id="a2be2c3d-f740-4e47-aa86-3de841df0338" class="">Example utterances:</p><ul id="212b2d91-b6e3-4caa-aa70-c2627438da00" class="bulleted-list"><li style="list-style-type:disc">start the {theme} theme</li></ul><ul id="97de0333-f6ac-431f-a6e8-77ec3554993a" class="bulleted-list"><li style="list-style-type:disc">play the {theme} theme</li></ul><ul id="98b3649b-4807-436a-ab2c-60e8db34478b" class="bulleted-list"><li style="list-style-type:disc">enter the {theme} theme</li></ul></div><div id="e13254fc-052a-4962-9733-00ce8863c618" style="width:50%" class="column"><p id="fc2ce8f3-6168-4a43-8b45-1d60b566b56a" class=""><strong>Enter Interviews</strong></p><p id="ced80963-0b1b-48cb-9d45-636acfc90668" class="">Begins playing all the interviews with a user specified person</p><p id="778108e9-b1cb-47e2-b9b3-ff021fb821b9" class="">Example utterances:</p><ul id="fd50796b-6cff-4ef5-a9e7-08ba74a9caf4" class="bulleted-list"><li style="list-style-type:disc">open the interview with {interviewee}</li></ul><ul id="952c4cae-04ee-461d-989c-b89f374d5e40" class="bulleted-list"><li style="list-style-type:disc">start the interview with {interviewee}</li></ul><ul id="d152ce78-cb9e-4d09-bd64-39d2d13d2615" class="bulleted-list"><li style="list-style-type:disc">play the interview with {interviewee}</li></ul><p id="0452aa11-8212-41ff-9ef0-1ab20abaf29a" class="">
</p></div></div><div id="d1ef568a-f77d-4283-87f9-e6419bcf3a12" class="column-list"><div id="98805270-ad92-45cc-82d7-f912d7b03c7a" style="width:50%" class="column"><p id="a4a04cdf-2458-4b08-a8ce-df296ba480a0" class=""><strong>Path Choice</strong></p><p id="9c34c62b-cd26-4299-b644-454f4a1e39de" class="">How a user specifies their choice of path at points in an audio collection where there is a branching point</p><p id="e90024b2-8e0c-4df8-ac33-a6bd9b416e67" class="">Example utterances:</p><ul id="e6b2ce1c-1789-4608-a548-2a07ff311d12" class="bulleted-list"><li style="list-style-type:disc">I want to hear about {path}</li></ul><ul id="1177fb89-b4e7-4c9b-b15d-69df9708356d" class="bulleted-list"><li style="list-style-type:disc">lets listen to {path}</li></ul><p id="a818b038-7aa2-45a2-8262-ffd1ee1a1253" class="">
</p><p id="66466358-5271-479b-8d3c-805aaa288383" class=""><strong>Rewind</strong></p><p id="b48264b7-2854-45c9-ac16-0509570dad21" class="">Allows the user to skip backwards a specified amount of time within the currently playing audio file</p><p id="c7b8347f-08d0-4a82-80dc-410a28111928" class="">Example utterances:</p><ul id="ef05cb2e-ebc3-4a4f-9b59-cd8af5e14571" class="bulleted-list"><li style="list-style-type:disc">reverse {time}</li></ul><ul id="fb98a570-d639-49ae-ac3f-08db4aa5524b" class="bulleted-list"><li style="list-style-type:disc">go backwards {time}</li></ul><ul id="e000eae2-4df0-46ec-a0c2-41d774bd56c3" class="bulleted-list"><li style="list-style-type:disc">rewind {time}</li></ul><ul id="3961f4a9-cd01-4b83-8fc0-d299354afcf7" class="bulleted-list"><li style="list-style-type:disc">I want to hear {path}</li></ul></div><div id="97503133-bf1a-4c7d-ba20-318ca0a7a61f" style="width:50%" class="column"><p id="74eede90-7c4f-4a35-b3b1-5bbfcfec83bb" class=""><strong>Fast Forward</strong></p><p id="75f97332-f46f-4d47-862d-9f1f6694f7ba" class="">Allows the user to skip forward a specified amount of time within the currently playing audio file</p><p id="60ba7680-d3fb-45f4-8410-6f8dbe004f05" class="">Example utterances:</p><ul id="ce9553d2-c75a-48d3-baa9-139cea3c335c" class="bulleted-list"><li style="list-style-type:disc">skip ahead {time}</li></ul><ul id="c20d7ce1-615d-4b30-9453-1e0b9c3166b1" class="bulleted-list"><li style="list-style-type:disc">skip forward {time}</li></ul><ul id="b578bc58-74cf-44c3-bd7b-ff84963c4814" class="bulleted-list"><li style="list-style-type:disc">fast forward {time}</li></ul></div></div><hr id="7e9a58e9-319e-4569-92e7-1a62ad830548"/><h2 id="e96e8f4f-cb46-45cc-8229-97be99428a91" class="">Intent Handlers</h2><p id="2017346a-071b-4912-9e6f-bb718c45068a" class=""><em>Intent handler boiler plate code is excluded from these snippets for brevity but understand they follow all follow the following form:</em></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="85991e24-142d-4f11-a55f-8c68f6a546c7" class="code"><code class="language-JavaScript">const CustomIntentHandler = {
  canHandle(handlerInput) {
    return (
      Alexa.getRequestType(handlerInput.requestEnvelope) === &#x27;IntentRequest&#x27; &amp;&amp;
      Alexa.getIntentName(handlerInput.requestEnvelope) === &#x27;CustomIntent&#x27;
    );
  },
  async handle(handlerInput) {
		//...
		//intent logic
		//...
} catch (error) {
      console.error(`Error retrieving data from Firestore: ${error}`);
      const speakOutput = `Error retrieving data from Firestore: ${error}`;
      return handlerInput.responseBuilder
        .speak(speakOutput)
        .getResponse();
    }
  },
	};</code></pre><p id="f29efbf9-0856-4f15-a179-0125c74290b0" class="">
</p><p id="c31bbab7-3cd1-4ac0-8173-42eca1ecdff3" class=""><strong>Enter Collection Intent Handler</strong></p><p id="47923e1c-18ed-4ac3-b8dc-57a3d9d14be2" class="">This handler is responsible for querying the database for the user specified audio collection and building the main playlist. For each entry in the audio collections main playlist, an object is created containing the name, audio URL, theme and if that entry is a branching pointing in the collection. These objects are populated in the <code>tracks</code> array, which is then passed into the <code>playAudioUrls</code> function. We will touch on this function later.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="57dc7dea-8c9b-4cbc-a5fa-8821a7caddda" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">		async handle(handlerInput) {
			let audioCollectionsRef;
			let mainPlaylistDocsRef;
			audioCollectionsRef = DB.collection(&#x27;audio collections&#x27;).doc(collectionName).collection(&#x27;interviews&#x27;);
			mainPlaylistDocsRef = audioCollectionsRef
			    .where(&#x27;mainPlaylist&#x27;, &#x27;==&#x27;, true)
			    .orderBy(&#x27;mainPlaylistOrder&#x27;);
			
			const mainPlaylistDocsSnapshot = await mainPlaylistDocsRef.get();
			const tracks = [];
			
			//An object is created for each entry that&#x27;s queried from a collection
			//and placed in an array of track
			mainPlaylistDocsSnapshot.forEach(doc =&gt; {
			    const data = doc.data();
			    if (data.url) {
			        tracks.push({
			            name: data.name,
			            url: data.url,
			            theme: data.theme,
				//the branching point value is not currently used in the branching point logic
			            isBranchingPoint: data.isBranchingPoint || false,
			        });
			    }
			});
			handlerInput.attributesManager.setSessionAttributes(sessionAttributes);
			return playAudioUrls(handlerInput, tracks, 0);
		}</code></pre><p id="3747e86e-6edf-447c-a02e-f375e25b7446" class="">
</p><p id="8da0b8de-2f07-48f1-9391-07b9ac145205" class=""><strong>List Collections Intent Handler</strong></p><p id="28817a64-a6a3-4d7c-ab81-09f078ba0f4e" class="">This handler is responsible for listing all the available collections in the database</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="93d4db39-b480-4242-868e-9678b3c902ba" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">	async handle(handlerInput) {
    let speakOutput = &#x27;&#x27;;
    let collectionNames = [];

    try {
      const audioCollectionsRef = DB.collection(&#x27;audio collections&#x27;);
      const collectionsSnapshot = await audioCollectionsRef.get();

      if (collectionsSnapshot.size &gt; 0) {
        collectionsSnapshot.forEach(doc =&gt; {
          collectionNames.push(doc.id);
        });
        
        speakOutput = `The available collections are: ${collectionNames.join(&#x27;, &#x27;)}. Please select a collection to hear about.`;
        handlerInput.attributesManager.setSessionAttributes({ collectionNames });
      } else {
        speakOutput = &#x27;There are no collections available.&#x27;;
      }
    } catch (error) {
      console.error(`Error retrieving data from Firestore: ${error}`);
      speakOutput = &#x27;Sorry, an error occurred while retrieving the data. Please try again later.&#x27;;
    }
    return handlerInput.responseBuilder
      .speak(speakOutput)
      .reprompt(&#x27;Please select a collection to hear about.&#x27;)
      .getResponse();
  },
};</code></pre><p id="9e548177-0410-4d62-a68f-aa96aee39cf4" class="">
</p><p id="b1be3fba-190c-4691-aca0-f2fa0bfb34f7" class=""><strong>Enter Theme Intent Handler</strong></p><p id="89f07824-5612-4eba-ad86-08ed39eb6466" class="">This handler is responsible for retrieving the theme tracks from the sub-playlist relevant to the currently playing theme and passing them into the <code>playAudioUrls</code> function.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="01a5b23d-43b7-4dc3-9a7d-138fc6752fa7" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"> async handle(handlerInput) {
    const { attributesManager } = handlerInput;
    let playbackInfo = await attributesManager.getPersistentAttributes();
    const currentTrack = playbackInfo.queue[playbackInfo.currentIndex];
    const currentTheme = currentTrack.theme;

    try {
      const interviewDocs = await DB.collection(&#x27;audio collections&#x27;)
        .doc(&#x27;pandemic interviews&#x27;) 
        .collection(&#x27;interviews&#x27;)
        .where(&#x27;theme&#x27;, &#x27;==&#x27;, currentTheme)
        .orderBy(&#x27;playOrder&#x27;)
        .get();

      const interviewTracks = interviewDocs.docs.map(doc =&gt; doc.data());

      if (interviewTracks.length === 0) {
        const speakOutput = `Sorry, no interviews were found for the theme ${currentTheme}.`;
        return handlerInput.responseBuilder
          .speak(speakOutput)
          .getResponse();
      } else {
        return playAudioUrls(handlerInput, interviewTracks, 0);
      }
    } </code></pre><p id="681ebf0c-634e-4334-a387-e50417f37cb9" class="">
</p><p id="f85d4fb6-fd9c-4a61-934f-2837b39fd9b1" class=""><strong>More From Current Intent Handler</strong></p><p id="12c7492a-0eaa-4db2-845e-5a3b354e34ee" class="">This handler is responsible for retrieving the sub-playlist of all the interviews from the currently playing individual and passing them into the <code>playAudioUrls</code> function.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="67d1a4d9-2c8f-4bc3-97e1-b8fa3b6d8d04" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"> async handle(handlerInput) {
    const { attributesManager } = handlerInput;
    let playbackInfo = await attributesManager.getPersistentAttributes();
    const currentTrack = playbackInfo.queue[playbackInfo.currentIndex];
    const currentName = currentTrack.name;

    try {
      const interviewDocs = await DB.collection(&#x27;audio collections&#x27;)
        .doc(&#x27;pandemic interviews&#x27;) 
        .collection(&#x27;interviews&#x27;)
        .where(&#x27;name&#x27;, &#x27;==&#x27;, currentName.toLowerCase())
        .orderBy(&#x27;playOrder&#x27;)
        .get();

      const interviewTracks = interviewDocs.docs.map(doc =&gt; doc.data());

      if (interviewTracks.length === 0) {
        const speakOutput = `Sorry, no additional interviews were found for ${currentName}.`;
        return handlerInput.responseBuilder
          .speak(speakOutput)
          .getResponse();
      } else {
        return playAudioUrls(handlerInput, interviewTracks, 0);
      }
    } 
</code></pre><p id="2a9822ba-6d51-4c04-96c9-c909efd739fe" class="">
</p><p id="7362a150-5228-4451-bbad-da695288aeee" class=""><strong>Path Choice Intent Handler</strong></p><p id="80707a1b-8f55-402f-8c44-49772551c871" class="">This intent handler is responsible for handling a user’s choice when they reach a branching point within an audio collection. We are looking to improve upon this logic as it currently operates the same as the Enter Theme intent. More on this in the <a href="https://www.notion.so/Story-Hub-0d17a570e2534fc0ab9a24a475760a59?pvs=21">Issues and Limitations</a> section.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0380e972-6a82-46a2-b323-ca5d22a3fb98" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">async handle(handlerInput) {
    const userChoice = Alexa.getSlotValue(handlerInput.requestEnvelope, &#x27;path&#x27;);
    
    try {
      const interviewDocs = await DB.collection(&#x27;audio collections&#x27;)
        .doc(&#x27;pandemic interviews&#x27;)
        .collection(&#x27;interviews&#x27;)
        .where(&#x27;theme&#x27;, &#x27;==&#x27;, userChoice.toLowerCase())
        .orderBy(&#x27;themeOrder&#x27;)
        .get();

      const tracks = interviewDocs.docs.map(doc =&gt; {
        const data = doc.data();
        return {
          name: data.name,
          url: data.url,
          theme: data.theme,
          isBranchingPoint: data.isBranchingPoint,
        };
      });
    
      return playAudioUrls(handlerInput, tracks, 0);

    }</code></pre><p id="848a3991-71c7-4eb5-91f8-4febe4470f7a" class="">
</p><hr id="b12991a1-6d9b-4594-bd22-dc99a6b2456d"/><h1 id="00a89dbe-b48a-44a6-81a0-da83c4f85cda" class="">Audio Playback</h1><p id="5e92268b-5113-4b3e-b235-37ac8de9cdef" class="">After audio has been retrieved and structured, playback is achieved using Alexa’s <strong><a href="https://developer.amazon.com/en-US/docs/alexa/custom-skills/audioplayer-interface-reference.html">AudioPlayer Interface</a></strong>, along with some additional functions to handle playback via AudioPlayer directives.</p><h3 id="c06e72d0-3ecd-4184-997c-caae584e6b74" class=""><strong>Persistent Attributes</strong></h3><p id="3948b41f-e4d7-4528-938f-28cfe513d148" class=""><a href="https://developer.amazon.com/en-US/docs/alexa/alexa-skills-kit-sdk-for-nodejs/manage-attributes.html#dynamodbpersistenceadapter">Persistent attributes</a> are a key part in the audio playback for this skill. They are used to keep track of a user&#x27;s progress within the audio content. This includes details such as the current track being played, the playback position within that track, and the queue of audio tracks. As each track is played or skipped, the queue is updated in the persistent attributes accordingly. These persistent attributes are managed using the <strong>DynamoDbPersistenceAdapter. </strong></p><p id="e390a8e9-8a78-42bd-8098-e95a3aa8849b" class="">There are two functions that are used for managing these persistent attributes:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0d2e5272-d576-453d-b784-14a952847a27" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">const LoadPersistentAttributesRequestInterceptor = {
  async process(handlerInput) {
    const { attributesManager } = handlerInput;
    const persistentAttributes = await attributesManager.getPersistentAttributes();

    if (Object.keys(persistentAttributes).length === 0 ||
        !persistentAttributes.playbackInfo ||
        persistentAttributes.playbackInfo.queue.length === 0) {
      const playbackSetting = {
        loop: false,
        shuffle: false,
      };
      const playbackInfo = {
        queue: [],
        currentIndex: 0,
        offsetInMilliseconds: 0,
      };

      persistentAttributes.playbackSetting = playbackSetting;
      persistentAttributes.playbackInfo = playbackInfo;
      attributesManager.setPersistentAttributes(persistentAttributes);
      await attributesManager.savePersistentAttributes();
    }
  },
};

const SavePersistentAttributesResponseInterceptor = {
    async process(handlerInput) {
        await handlerInput.attributesManager.savePersistentAttributes();
    },
};</code></pre><p id="23fb7e79-10f6-468a-9374-61be619fd654" class="">
</p><p id="70661018-83a1-4eb5-8905-6505b0b3c2a4" class="">
</p><h3 id="ba1784d9-7cf1-4f8f-808b-59d61d381269" class="">Audio Playback Functions</h3><p id="c791d7da-1fec-4509-bc48-df1e44d2bf10" class=""><strong>playAudioUrls</strong></p><p id="4f0e3bff-d832-4c93-ac53-0c0701345417" class="">This function is used anytime a user triggers an intent that has to do with audio playback (<em>Enter Collection, Enter Interviews, Enter Theme, etc..</em> ).</p><p id="39139cfe-6ab5-49fb-bb14-598753667035" class="">Playback info, including the playlist (<code>queue</code>) of tracks, the currently playing track (<code>currentIndex</code>), and how far a track has progressed (<code>offsetInMillisecond</code>) are all stored as persistent attributes.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="73929a32-215e-46d6-91cf-b8bb9f97ef92" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">async function playAudioUrls(handlerInput, tracks, currentIndex = 0, offsetInMilliseconds = 0, isSkip = false) {
  const { attributesManager } = handlerInput;
  const playbackInfo = {
    queue: tracks,
    currentIndex: currentIndex,
    offsetInMilliseconds: offsetInMilliseconds,
  };

  attributesManager.setPersistentAttributes(playbackInfo);
  await attributesManager.savePersistentAttributes();

  const currentTrack = tracks[currentIndex];
  const audioUrl = currentTrack.url;
  const playBehavior = currentIndex === 0 || isSkip ? &#x27;REPLACE_ALL&#x27; : &#x27;ENQUEUE&#x27;;

  const expectedPreviousToken = playBehavior === &#x27;REPLACE_ALL&#x27; ? null : tracks[currentIndex - 1].url;

  return handlerInput.responseBuilder
    .addAudioPlayerPlayDirective(playBehavior, audioUrl, audioUrl, playbackInfo.offsetInMilliseconds, expectedPreviousToken)
    .getResponse();
}</code></pre><p id="dfa24fd9-2204-4ebe-8ae8-962c9526f6fc" class=""><strong>AudioPlayerEventHandler</strong></p><p id="a359a91d-8d03-443b-aad5-cd50e25917e6" class="">This function is responsible for handling the AudioPlayer directives and requests.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3ecda472-2688-4bb8-ac58-e087742e15eb" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">const AudioPlayerEventHandler = {
  canHandle(handlerInput) {
    const requestType = Alexa.getRequestType(handlerInput.requestEnvelope);
    return requestType.startsWith(&#x27;AudioPlayer.&#x27;);
  },
  async handle(handlerInput) {
    const requestType = Alexa.getRequestType(handlerInput.requestEnvelope);
    const { attributesManager } = handlerInput;
    let playbackInfo = await attributesManager.getPersistentAttributes();

    switch(requestType) {
      case &#x27;AudioPlayer.PlaybackStarted&#x27;:
        return handlerInput.responseBuilder.getResponse();
      case &#x27;AudioPlayer.PlaybackFinished&#x27;:
        return handlerInput.responseBuilder.getResponse();
      case &#x27;AudioPlayer.PlaybackStopped&#x27;:
        const { request } = handlerInput.requestEnvelope;
        const { offsetInMilliseconds } = request;
        playbackInfo.offsetInMilliseconds = offsetInMilliseconds;
        await attributesManager.setPersistentAttributes(playbackInfo);
        await attributesManager.savePersistentAttributes();
        return handlerInput.responseBuilder.getResponse();

			//when audio file nears end of playback the next track in queue is retrieved
			//and played
      case &#x27;AudioPlayer.PlaybackNearlyFinished&#x27;:
        const nextIndex = playbackInfo.currentIndex + 1;

        if (nextIndex &lt; playbackInfo.queue.length) {
          return playAudioUrls(handlerInput, playbackInfo.queue, nextIndex);
        } else {
          return handlerInput.responseBuilder.getResponse();
        }
      case &#x27;AudioPlayer.PlaybackFailed&#x27;:
        console.log(JSON.stringify(handlerInput.requestEnvelope.request.error, null, 2));
        return handlerInput.responseBuilder.getResponse();
      default:
        return handlerInput.responseBuilder.getResponse();
    }
  }
};</code></pre><p id="2fe9c8c4-db66-4f83-9b73-abf2394b9496" class="">
</p><h3 id="215fc891-7113-489f-a1f8-f6333fdaf9ce" class="">Custom Audio Intents</h3><p id="8e1c3c6e-9134-4e1b-bdab-7f00d08d96e5" class="">Alexa’s <code>AudioPlayer</code> lacks a few basic remote functionalities, including the ability to fast forward and rewind within a track. These next two intent handlers add this functionality to the skill.</p><p id="8c759b08-f178-4170-98c4-7a69ad92c54c" class=""><strong>Fast Forward Intent Handler</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fc7b2152-8fc2-4df0-84a1-68eeecd2312d" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">const FastForwardIntentHandler = {
  canHandle(handlerInput) {
    return (
      Alexa.getRequestType(handlerInput.requestEnvelope) === &#x27;IntentRequest&#x27; &amp;&amp;
      Alexa.getIntentName(handlerInput.requestEnvelope) === &#x27;fastForward&#x27;
    );
  },
  async handle(handlerInput) {
    const duration = Alexa.getSlotValue(handlerInput.requestEnvelope, &#x27;time&#x27;);
    
    const fastForwardMs = parseDuration(duration);

    const { attributesManager } = handlerInput;
    let playbackInfo = await attributesManager.getPersistentAttributes();

    const urls = playbackInfo.queue;
    const currentIndex = playbackInfo.currentIndex;
    const offsetInMilliseconds = playbackInfo.offsetInMilliseconds + fastForwardMs;

    return playAudioUrls(handlerInput, urls, currentIndex, offsetInMilliseconds, true);
  },
};</code></pre><p id="fe492d25-256e-4e54-9ec1-c02891ed47f5" class=""><strong>Rewind Intent Handler</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8a838c72-ede5-4843-99c0-cfee553d9033" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">const RewindIntentHandler = {
  canHandle(handlerInput) {
    return (
      Alexa.getRequestType(handlerInput.requestEnvelope) === &#x27;IntentRequest&#x27; &amp;&amp;
      Alexa.getIntentName(handlerInput.requestEnvelope) === &#x27;rewind&#x27;
    );
  },
  async handle(handlerInput) {
    const duration = Alexa.getSlotValue(handlerInput.requestEnvelope, &#x27;time&#x27;);
    
    const rewindMs = parseDuration(duration);

    const { attributesManager } = handlerInput;
    let playbackInfo = await attributesManager.getPersistentAttributes();

    const urls = playbackInfo.queue;
    const currentIndex = playbackInfo.currentIndex;
    let offsetInMilliseconds = playbackInfo.offsetInMilliseconds - rewindMs;

    offsetInMilliseconds = Math.max(0, offsetInMilliseconds);

    return playAudioUrls(handlerInput, urls, currentIndex, offsetInMilliseconds, true);
  },
};</code></pre><p id="29770432-eff5-451e-9dee-7adc4afc5a31" class="">
</p><h1 id="9141763a-054b-449c-94f8-598b97998c46" class="">Current Issues and Limitations</h1><p id="65852420-778d-442b-bed9-28bb6a076c01" class="">
</p><p id="200870e7-acef-4a92-b328-a41d3fd82fa9" class=""><strong>Prompting for user input at branching points</strong></p><p id="3535a579-4a5d-4560-ad14-2ae79af9b717" class="">Because this skills uses the audio player interface for audio playback, it’s not currently possible to prompt a user for a response at points within a playlist of tracks. This type of interaction is only possible using <a href="https://developer.amazon.com/en-US/docs/alexa/custom-skills/speech-synthesis-markup-language-ssml-reference.html#audio">SSML audio tags</a> which have their own set of limitations. Audio files cant’t be longer than 4 minutes, they need to be specifically formatted for SSML, audio quality is significantly lower, and it does not have the features that the audio player interface allows for, such as queuing up playlists of audio files and tracking progression of audio.</p><p id="7aa3d456-4542-4573-b0de-943f3c6eb101" class="">
</p><p id="19cf07fe-72aa-4297-abb8-75ee58ae121e" class="">Currently, branching points are reached at the end of the main playlist, and the user must invoke the <code>PathChoice</code> intent by saying a phrase such as “Alexa, tell story hub I want to hear about {path choice}”. Ideally at branching points users would be prompted for path options and all they would need to say to enter a path is a single word.</p><p id="dd8d128f-0da6-4435-97d9-56ae8a0f5be3" class="">
</p><p id="34902066-92b3-465c-90dd-7895e33f1749" class=""><strong>Invocation Name Requirement</strong></p><p id="d4aa6953-5894-40da-921f-a51333066dc6" class="">Interactions feel clunky at times due to the need to say the skills invocation name to trigger custom intents. For example, during playback, if a user to wanted to enter the sub playlist of all the tracks for the theme of the currently playing theme, they would need to say “Alexa, tell Story Hub to play more on this topic”. </p><p id="f0c28383-9f29-44d3-9916-bfc828a4fc7a" class=""><a href="https://developer.amazon.com/en-US/docs/alexa/custom-skills/understand-name-free-interaction-for-custom-skills.html">Name-free interactions</a> could possibly provide a workaround for this but more research is needed.</p><p id="98ef7446-d287-4ad2-a5cb-8b01c5a37304" class="">
</p><p id="7c0bbd60-04ff-49cf-9b97-21357dd5a4cb" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>
